@startuml DiagramaCompleto

!theme plain

package "Entidades Principales" {
    
    class Usuario {
        - idUsuario: INTEGER (PK)
        - keycloak_user_id: STRING(100)
        - persona_id: INTEGER (FK)
        - roles_asignados: STRING(500)
        - estado_aprobacion: ENUM
        - activo: BOOLEAN
        - creado: DATE
        - actualizado: DATE
    }

    class Persona {
        - idPersona: INTEGER (PK)
        - tipo_documento_id: INTEGER (FK)
        - numero_documento: STRING(50)
        - nombres: STRING(100)
        - apellidos: STRING(100)
        - email: STRING(150)
        - telefono: STRING(20)
        - telefono_emergencia: STRING(20)
        - fecha_nacimiento: DATE
        - sexo_id: INTEGER (FK)
        - direccion_id: INTEGER (FK)
        - foto_perfil: STRING(255)
        - activo: BOOLEAN
    }

    class Paciente {
        - idPaciente: INTEGER (PK)
        - persona_id: INTEGER (FK)
        - numero_expediente: STRING(50)
        - tipo_sangre: STRING(5)
        - alergias: TEXT
        - enfermedades_cronicas: TEXT
        - medicamentos_actuales: TEXT
        - contacto_emergencia_nombre: STRING(100)
        - contacto_emergencia_telefono: STRING(20)
        - seguro_medico: STRING(100)
        - activo: BOOLEAN
    }

    class PersonalMedico {
        - idPersonalMedico: INTEGER (PK)
        - persona_id: INTEGER (FK)
        - centro_id: INTEGER (FK)
        - numero_licencia: STRING(50)
        - numero_colegiado: STRING(50)
        - especialidad_id: INTEGER (FK)
        - cargo: STRING(100)
        - universidad: STRING(200)
        - anos_experiencia: INTEGER
        - calificacion_promedio: DECIMAL(3,2)
        - total_consultas: INTEGER
        - activo: BOOLEAN
        - verificado: BOOLEAN
    }

    class Cita {
        - idCita: INTEGER (PK)
        - numero_cita: STRING(50)
        - paciente_id: INTEGER (FK)
        - personal_medico_id: INTEGER (FK)
        - centro_id: INTEGER (FK)
        - tipo_cita_id: INTEGER (FK)
        - estado_cita_id: INTEGER (FK)
        - prioridad_id: INTEGER (FK)
        - fecha_hora: DATE
        - motivo: TEXT
    }

    class Consulta {
        - idConsulta: INTEGER (PK)
        - cita_id: INTEGER (FK)
        - diagnostico_principal: TEXT
        - diagnosticos_secundarios: TEXT
        - tratamiento: TEXT
        - observaciones: TEXT
        - receta_medica: TEXT
        - examenes_solicitados: TEXT
        - duracion_minutos: INTEGER
        - calificacion_paciente: INTEGER
        - requiere_seguimiento: BOOLEAN
    }

    class ConfiguracionCentro {
        - idConfiguracion: INTEGER (PK)
        - nombre_centro: STRING(200)
        - direccion: STRING(500)
        - telefono: STRING(20)
        - email: STRING(150)
        - director_medico_id: INTEGER (FK)
        - administrador_sistema_id: INTEGER (FK)
        - activo: BOOLEAN
    }
}

package "Datos Médicos" {
    
    class SignosVitales {
        - idSignosVitales: INTEGER (PK)
        - consulta_id: INTEGER (FK)
        - presion_sistolica: INTEGER
        - presion_diastolica: INTEGER
        - frecuencia_cardiaca: INTEGER
        - temperatura: DECIMAL(4,2)
        - peso: DECIMAL(5,2)
        - altura: DECIMAL(5,2)
        - saturacion_oxigeno: INTEGER
        - tomado_por: INTEGER (FK)
        - fecha_toma: DATE
    }

    class Archivo {
        - idArchivo: INTEGER (PK)
        - consulta_id: INTEGER (FK)
        - paciente_id: INTEGER (FK)
        - nombre_archivo: STRING(255)
        - ruta_archivo: STRING(500)
        - tipo_archivo: STRING(100)
        - tamano_bytes: BIGINT
        - creado_por: INTEGER (FK)
        - fecha_subida: DATE
    }
}

package "Comunicación" {
    
    class Mensaje {
        - idMensaje: INTEGER (PK)
        - remitente_id: INTEGER (FK)
        - paciente_id: INTEGER (FK)
        - personal_medico_id: INTEGER (FK)
        - contenido: TEXT
        - fecha_envio: DATE
        - leido: BOOLEAN
    }

    class Recordatorio {
        - idRecordatorio: INTEGER (PK)
        - usuario_id: INTEGER (FK)
        - titulo: STRING(200)
        - mensaje: TEXT
        - fecha_recordatorio: DATE
        - enviado: BOOLEAN
    }
}

package "Ubicación" {
    
    class Direccion {
        - idDireccion: INTEGER (PK)
        - departamento_id: INTEGER (FK)
        - municipio_id: INTEGER (FK)
        - aldea_id: INTEGER (FK)
        - direccion_exacta: TEXT
    }

    class Departamento {
        - idDepartamento: INTEGER (PK)
        - nombre: STRING(100)
        - codigo: STRING(10)
    }

    class Municipio {
        - idMunicipio: INTEGER (PK)
        - departamento_id: INTEGER (FK)
        - nombre: STRING(100)
        - codigo: STRING(10)
    }

    class Aldea {
        - idAldea: INTEGER (PK)
        - municipio_id: INTEGER (FK)
        - nombre: STRING(100)
        - codigo: STRING(10)
    }
}

package "Catálogos" {
    
    class TiposDocumentoIdentidad {
        - idTipoDocumento: INTEGER (PK)
        - nombre: STRING(50)
        - codigo: STRING(10)
        - activo: BOOLEAN
    }

    class Sexo {
        - idSexo: INTEGER (PK)
        - nombre: STRING(20)
        - codigo: STRING(1)
    }

    class Especialidades {
        - idEspecialidad: INTEGER (PK)
        - nombre: STRING(100)
        - descripcion: TEXT
        - activo: BOOLEAN
    }

    class TiposCita {
        - idTipoCita: INTEGER (PK)
        - nombre: STRING(50)
        - descripcion: TEXT
        - duracion_estimada: INTEGER
        - precio: DECIMAL(10,2)
        - activo: BOOLEAN
    }

    class EstadosCita {
        - idEstadoCita: INTEGER (PK)
        - nombre: STRING(50)
        - descripcion: TEXT
        - color: STRING(7)
    }

    class PrioridadesCita {
        - idPrioridad: INTEGER (PK)
        - nombre: STRING(50)
        - nivel: INTEGER
        - descripcion: TEXT
        - color: STRING(7)
    }
}

package "Programación" {
    
    class DisponibilidadPersonalMedico {
        - idDisponibilidad: INTEGER (PK)
        - personal_medico_id: INTEGER (FK)
        - dia_semana_id: INTEGER (FK)
        - hora_inicio: TIME
        - hora_fin: TIME
        - activo: BOOLEAN
    }

    class DiasSemana {
        - idDiaSemana: INTEGER (PK)
        - nombre: STRING(20)
        - numero_dia: INTEGER
    }
}

package "Administración" {
    
    class SolicitudRol {
        - idSolicitudRol: INTEGER (PK)
        - usuario_id: INTEGER (FK)
        - rol_solicitado: STRING(100)
        - justificacion: TEXT
        - estado: ENUM
        - revisado_por: INTEGER (FK)
        - fecha_revision: DATE
        - creado: DATE
    }

    class EstadisticasDiarias {
        - idEstadistica: INTEGER (PK)
        - centro_id: INTEGER (FK)
        - fecha: DATE
        - total_citas: INTEGER
        - citas_completadas: INTEGER
        - citas_canceladas: INTEGER
        - nuevos_pacientes: INTEGER
        - total_consultas: INTEGER
    }

    class LogSistema {
        - idLog: INTEGER (PK)
        - usuario_id: INTEGER (FK)
        - accion: STRING(100)
        - tabla_afectada: STRING(50)
        - registro_id: INTEGER
        - datos_anteriores: JSON
        - datos_nuevos: JSON
        - ip_address: STRING(45)
        - user_agent: TEXT
        - fecha: DATE
    }
}

' Relaciones principales
Usuario ||--|| Persona : "perfil"
Persona ||--o{ Paciente : "es"
Persona ||--o{ PersonalMedico : "es"

' Relaciones de ubicación
Persona }o--|| Direccion : "vive en"
Direccion }o--|| Departamento : "está en"
Direccion }o--|| Municipio : "está en"
Direccion }o--|| Aldea : "está en"
Municipio }o--|| Departamento : "pertenece a"
Aldea }o--|| Municipio : "pertenece a"

' Relaciones de documentos y sexo
Persona }o--|| TiposDocumentoIdentidad : "tipo documento"
Persona }o--|| Sexo : "sexo"

' Relaciones de citas y consultas
Paciente ||--o{ Cita : "agenda"
PersonalMedico ||--o{ Cita : "atiende"
Cita }o--|| TiposCita : "tipo"
Cita }o--|| EstadosCita : "estado"
Cita }o--|| PrioridadesCita : "prioridad"
Cita }o--|| ConfiguracionCentro : "centro"
Cita ||--|| Consulta : "genera"

' Relaciones de datos médicos
Consulta ||--o{ SignosVitales : "incluye"
Consulta ||--o{ Archivo : "adjunta"
Paciente ||--o{ Archivo : "historial"

' Relaciones de personal médico
PersonalMedico }o--|| Especialidades : "especialidad"
PersonalMedico }o--|| ConfiguracionCentro : "trabaja en"
PersonalMedico ||--o{ DisponibilidadPersonalMedico : "horarios"
DisponibilidadPersonalMedico }o--|| DiasSemana : "día"

' Relaciones de comunicación
Usuario ||--o{ Mensaje : "envía"
Paciente ||--o{ Mensaje : "recibe de"
PersonalMedico ||--o{ Mensaje : "recibe de"
Usuario ||--o{ Recordatorio : "tiene"

' Relaciones administrativas
ConfiguracionCentro }o--|| PersonalMedico : "director médico"
ConfiguracionCentro }o--|| Usuario : "administrador"
Usuario ||--o{ SolicitudRol : "solicita"
ConfiguracionCentro ||--o{ EstadisticasDiarias : "estadísticas"
Usuario ||--o{ LogSistema : "acciones"
Usuario ||--o{ SignosVitales : "registra"
Usuario ||--o{ Archivo : "sube"

@enduml
